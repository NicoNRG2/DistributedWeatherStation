<!DOCTYPE html>
<html>
<body>

<h2>Dati stazione Marostica</h2>

<p>Temperatura: <span id="temperatura"></span></p>
<p>Umidità: <span id="umidita"></span></p>
<p>Pressione: <span id="pressione"></span></p>
<p>Altitudine: <span id="altezza"></span></p>
<p>Luminosità: <span id="luce"></span></p>

<canvas id="temperaturaChart"></canvas>
<canvas id="umiditaChart"></canvas>
<canvas id="pressioneChart"></canvas>
<canvas id="altezzaChart"></canvas>
<canvas id="luceChart"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Creiamo un array per ogni tipo di dato
var arrayTemperatura = new Array(24).fill(null);
var arrayUmidita = new Array(24).fill(null);
var arrayPressione = new Array(24).fill(null);
var arrayAltezza = new Array(24).fill(null);
var arrayLuce = new Array(24).fill(null);

// Connettiti al WebSocket
var socket = new WebSocket('ws://192.168.1.101:3000');

// Creiamo i grafici
var createChart = function(ctxId, label, data, color) {
    var ctx = document.getElementById(ctxId).getContext('2d');
    return new Chart(ctx, {
        type: 'line',
        data: {
            labels: Array.from({length: 24}, (_, i) => i + "h"),
            datasets: [{
                label: label,
                data: data,
                borderColor: color,
                fill: false
            }]
        },
        options: {
            scales: {
                x: {
                    display: true,
                    title: {
                        display: true,
                        text: 'Ore'
                    }
                },
                y: {
                    display: true,
                    title: {
                        display: true,
                        text: 'Valori'
                    }
                }
            }
        }
    });
};

var temperaturaChart = createChart('temperaturaChart', 'Temperatura', arrayTemperatura, 'red');
var umiditaChart = createChart('umiditaChart', 'Umidità', arrayUmidita, 'blue');
var pressioneChart = createChart('pressioneChart', 'Pressione', arrayPressione, 'green');
var altezzaChart = createChart('altezzaChart', 'Altezza', arrayAltezza, 'purple');
var luceChart = createChart('luceChart', 'Luce', arrayLuce, 'orange');

socket.onmessage = function(event) {
  // Supponiamo che i dati arrivino come stringa JSON
  var json = JSON.parse(event.data);

  // Se il luogo è "Marostica", aggiorna i dati
  if (json.luogo === "Marostica") {
    // Rimuovi il primo elemento e sposta tutti gli elementi a sinistra
    arrayTemperatura.shift();
    arrayUmidita.shift();
    arrayPressione.shift();
    arrayAltezza.shift();
    arrayLuce.shift();

    // Inserisci il nuovo dato in ultima posizione
    arrayTemperatura.push(json.temperatura);
    arrayUmidita.push(json.umidita);
    arrayPressione.push(json.pressione);
    arrayAltezza.push(json.altezza);
    arrayLuce.push(json.luce);

    // Aggiorna i grafici
    temperaturaChart.update();
    umiditaChart.update();
    pressioneChart.update();
    altezzaChart.update();
    luceChart.update();

    document.getElementById("temperatura").innerHTML = json.temperatura;
    document.getElementById("umidita").innerHTML = json.umidita;
    document.getElementById("pressione").innerHTML = json.pressione;
    document.getElementById("altezza").innerHTML = json.altezza;
    document.getElementById("luce").innerHTML = json.luce;
  }
};

</script>

</body>
</html>
